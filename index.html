<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Precios</title>
    <style>
        
        body {
            background-image: url(https://cocinemosjuntos.com.co/media/mageplaza/blog/post/c/o/condimentos-y-especias_1_.jpg);
            backdrop-filter: blur(5px);
            background-color: #1b1b32;
            color: #f5f6f7;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        .container {
            background: #4c125f;
            border-radius: 15px;
            padding: 2rem;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            margin-bottom: 2rem;
 }
 button{
    background-color:#ebaf0b;
 }
            title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: #ebaf0b;
            font-size: 2rem;
        }
        
        select, input, button {
            width: 95%;
            margin: 10px 0;
            padding: 10px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        #invoice {
            display: none;
            margin-top: 20px;
        }
        #calculator {
            display: block;
        }
        .invoice-total {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 20px;
            text-align: right;
        }
        input[type="category"]{
            background-color: #ebaf0b;
        }
        .invoice-button {
            margin-top: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        h2, p{
            text-align: center;
            margin-bottom: 1.5rem;
            color: #ebaf0b;
            font-size: 2rem;
            font-family: Tahoma, sans-serif;
        }
        @media print {
  @page {
    size: 80mm auto;
    margin: 5mm;
  }

  body * {
    visibility: hidden;
  }

  #invoice, #invoice * {
    visibility: visible;
  }

  #invoice {
    position: absolute;
    left: 0;
    top: 0;
    width: 80mm;
  }

  .no-print {
    display: none !important;
  }
}


    
    </style>
</head>
<body>
    <div id="calculator" class="container">
        <h2>Calculadora de precios</h2>
        <p id="dollarRate">Tasa del d√≥lar BCV:</p>
        <label for="category">Categoria:</label>
        <select id="category" onchange="filterProducts()">
            <option value="">Seleccione una categoria...</option>
          
            <option value="Condimentos Puros">Condimentos Puros</option>slot
            <option value="Condimentos semi">Condimentos semi</option>
            <option value="Hierbas e Infusiones">Hierbas e Infusiones</option>
            <option value="Semillas">Semillas</option>slot
            <option value="Maniseria">Maniseria</option>slot
            <option value="Turrones">Turrones</option>slot
            <option value="Granos">Granos</option>slot
            <option value="Qu√≠micos">Qu√≠micos</option>slot
            <option value="Esencias">Esencias</option>slot
            <option value="Bolsas">Bolsas</option>slot
            <option value="Animales">Animales</option>slot
            <option value="Colores">Colores</option>slot
            <option value="Reposter√≠a">Reposter√≠a</option>slot
            <option value="Agropecuaria">Agropecuaria</option>slot
        </select>
        <label for="product">Producto:</label>
            <select id="product" disabled>
                <option value="">Selecciona un producto...</option>
 <option value="4.20" data-category="Condimentos Semi">Ali√±o semi</option>slot
<option value="2.88" data-category="Condimentos Semi">Adobo semi</option>slot
<option value="4.12" data-category="Condimentos Semi">Carmencita</option>slot
<option value="6.04" data-category="Condimentos Semi">Pimienta semi</option>slot
<option value="2.58" data-category="Condimentos Semi">Cubito semi</option>slot
<option value="3.60" data-category="Condimentos Semi">Curry semi</option>slot
<option value="4.60" data-category="Condimentos Semi">Ajo semi</option>slot
<option value="8.64" data-category="Condimentos Semi">Comino semi</option>slot
<option value="4.32" data-category="Condimentos Semi">Sabroceador semi</option>slot
<option value="8.80" data-category="Condimentos Semi">Or√©gano Molido</option>slot
<option value="7.00" data-category="Condimentos Semi">Or√©gano Entero</option>slot
<option value="4.60" data-category="Condimentos Semi">Combinaditos</option>slot
<option value="7.30" data-category="Condimentos Puros">Ali√±o</option>slot
<option value="7.00" data-category="Condimentos Puros">Cubito</option>slot
<option value="6.48" data-category="Condimentos Puros">Adobo</option>slot
<option value="5.30" data-category="Condimentos Puros">Ajo Mix</option>slot
<option value="18.00" data-category="Condimentos Puros">Ajo Granulado</option>slot
<option value="17.04" data-category="Condimentos Puros">Cebolla</option>slot
<option value="12.00" data-category="Condimentos Puros">C√∫rcuma</option>slot
<option value="7.56" data-category="Condimentos Puros">Jengibre</option>slot
<option value="15.04" data-category="Condimentos Puros">Paprika Dulce</option>slot
<option value="13.04" data-category="Condimentos Puros">Paprika Picante</option>slot
<option value="20.00" data-category="Condimentos Puros">Comino</option>slot
<option value="11.04" data-category="Condimentos Puros">Curry</option>slot
<option value="26.00" data-category="Condimentos Puros">Pimienta</option>slot
<option value="5.94" data-category="Condimentos Puros">Trifog√≥n</option>slot
<option value="40.00" data-category="Condimentos Puros">7 Especies</option>slot
<option value="5.94" data-category="Condimentos Puros">Salchina</option>slot
<option value="6.50" data-category="Condimentos Puros">Ajo Entero</option>slot
<option value="18.00" data-category="Hierbas e Infusiones">Flor de Jamaica</option>slot
<option value="21.67" data-category="Hierbas e Infusiones">Manzanilla</option>slot
<option value="22.00" data-category="Hierbas e Infusiones">T√© Verde</option>slot
<option value="14.00" data-category="Hierbas e Infusiones">Sen</option>slot
<option value="13.60" data-category="Hierbas e Infusiones">Tomillo</option>slot
<option value="11.04" data-category="Hierbas e Infusiones">Menta</option>slot
<option value="15.00" data-category="Hierbas e Infusiones">Laurel</option>slot
<option value="13.60" data-category="Hierbas e Infusiones">Romero</option>slot
<option value="14.00" data-category="Hierbas e Infusiones">Albahaca</option>slot
<option value="19.44" data-category="Hierbas e Infusiones">Stevia</option>slot
<option value="39.00" data-category="Hierbas e Infusiones">Clavitos</option>slot
<option value="25.00" data-category="Hierbas e Infusiones">Canela Entera</option>slot
<option value="27.00" data-category="Hierbas e Infusiones">Canela Molida</option>slot
<option value="28.00" data-category="Hierbas e Infusiones">An√≠s Estrellado</option>slot
<option value="19.66" data-category="Hierbas e Infusiones">Malagueta</option>slot
<option value="9.28" data-category="Hierbas e Infusiones">Perejil</option>slot
<option value="55.00" data-category="Hierbas e Infusiones">Tilo</option>slot
<option value="7.2" data-category="Hierbas e Infusiones">Vinagre de manzana</option>slot
<option value="28.08" data-category="Hierbas e Infusiones">Aceite de coco</option>slot
<option value="7.13" data-category="Hierbas e Infusiones">Aceite de oliva</option>slot
<option value="36.00" data-category="Hierbas e Infusiones">nuez moscada</option>slot
<option value="0.75" data-category="Hierbas e Infusiones">Panela</option>slot
<option value="18.40" data-category="Semillas">Ch√≠a</option>slot
<option value="14.20" data-category="Semillas">An√≠s Dulce</option>slot
<option value="4.24" data-category="Semillas">Linaza</option>slot
<option value="5.60" data-category="Semillas">Girasol</option>slot
<option value="5.40" data-category="Semillas">Auyama</option>slot
<option value="4.32" data-category="Semillas">Patilla</option>slot
<option value="7.23" data-category="Semillas">Fenogreco</option>slot
<option value="4.86" data-category="Semillas">Ajonjol√≠ Natural</option>slot
<option value="12.00" data-category="Semillas">Ajonjol√≠ Blanco</option>slot
<option value="16.00" data-category="Semillas">Ajonjol√≠ Negro</option>slot
<option value="18.00" data-category="Semillas">Comino Entero</option>slot
<option value="24.00" data-category="Semillas">Pimienta Negra</option>slot
<option value="40.00" data-category="Semillas">Pimienta Blanca</option>slot
<option value="50.00" data-category="Semillas">Pimienta Roja</option>slot
<option value="14.00" data-category="Semillas">Hinojo</option>slot
<option value="13.04" data-category="Semillas">Quinoa</option>slot
<option value="7.04" data-category="Semillas">Mostaza</option>slot
<option value="14.00" data-category="Semillas">Cilantro</option>slot
<option value="5.55" data-category="Semillas">Cebada</option>slot
<option value="10.74" data-category="Semillas">Aceitunas</option>slot
<option value="7.50" data-category="Semillas">Alcaparras</option>slot
<option value="5.18" data-category="Semillas">Trigo Fino</option>slot
<option value="2.70" data-category="Semillas">Avena</option>slot
<option value="2.70" data-category="Semillas">Afrecho</option>slot
<option value="17.50" data-category="Semillas">Achote</option>slot
<option value="0.50" data-category="Semillas">Sal de Mesa</option>slot
<option value="8.60" data-category="Semillas">Pasas</option>slot
<option value="13.80" data-category="Semillas">Ciruela Pasas</option>slot
<option value="10.00" data-category="Semillas">Sal Rosada</option>slot
<option value="2.35" data-category="Semillas">Sal Marina</option>slot
<option value="7.20" data-category="Maniseria">Frutos secos</option>slot
<option value="6.20" data-category="Maniseria">Frutos secos +1kg</option>slot
<option value="6.00" data-category="Maniseria">Frutos secos +5kg</option>slot
<option value="18.00" data-category="Maniseria">Ma√≠z Tostado</option>slot
<option value="7.10" data-category="Maniseria">Man√≠ Triturado</option>slot
<option value="8.00" data-category="Maniseria">Cocomani</option>slot
<option value="12.60" data-category="Maniseria">Man√≠ Salado Jumbo</option>slot
<option value="6.40" data-category="Maniseria">Man√≠ con Ajonjol√≠</option>slot
<option value="8.00" data-category="Maniseria">Man√≠ Pimienta Lim√≥n</option>slot
<option value="8.40" data-category="Maniseria">Man√≠ con Concha</option>slot
<option value="6.40" data-category="Maniseria">Man√≠ Garrapi√±ado</option>slot
<option value="8.60" data-category="Maniseria">Man√≠ con Sal</option>slot
<option value="7.23" data-category="Maniseria">Man√≠ sin Sal</option>slot
<option value="12.80" data-category="Maniseria">Man√≠ Japon√©s y Variantes</option>slot
<option value="18.13" data-category="Maniseria">Almendras</option>slot
<option value="37.56" data-category="Maniseria">Almendras Fileteadas</option>slot
<option value="24.00" data-category="Maniseria">Almendras con Ajonjol√≠</option>slot
<option value="20.16" data-category="Maniseria">Almendras con Coco</option>slot
<option value="27.60" data-category="Maniseria">Almendras Garrapi√±adas</option>slot
<option value="30.08" data-category="Maniseria">Almendras Saladas</option>slot
<option value="24.69" data-category="Maniseria">Avellanas</option>slot
<option value="33.15" data-category="Maniseria">Merey</option>slot
<option value="33.58" data-category="Maniseria">Pistacho</option>slot
<option value="27.60" data-category="Maniseria">Nueces</option>slot
<option value="0.40" data-category="Turrones">Blanco con Man√≠</option>slot
<option value="0.40" data-category="Turrones">Acaramelado con Ajonjol√≠</option>slot
<option value="0.40" data-category="Turrones">Acaramelado con Man√≠</option>slot
<option value="0.40" data-category="Turrones">Mixto</option>slot
<option value="2.16" data-category="Turrones">Gourmet</option>slot
<option value="5.20" data-category="Granos">Caraota Negra</option>slot
<option value="3.02" data-category="Granos">Caraota Roja</option>slot
<option value="3.24" data-category="Granos">Caraota Blanca</option>slot
<option value="4.75" data-category="Granos">Arvejas</option>slot
<option value="5.50" data-category="Granos">Lentejas</option>slot
<option value="2.32" data-category="Granos">Cotufas</option>slot
<option value="4.80" data-category="Granos">Garbanzos</option>slot
<option value="1.62" data-category="Granos">Pico Negro</option>slot
<option value="9.04" data-category="Qu√≠micos">Benzoato</option>slot
<option value="6.78" data-category="Qu√≠micos">Sal de Epson</option>slot
<option value="5.20" data-category="Qu√≠micos">√Åcido C√≠trico</option>slot
<option value="3.87" data-category="Qu√≠micos">Azufre</option>slot
<option value="12.56" data-category="Qu√≠micos">√Åcido B√≥rico</option>slot
<option value="7.70" data-category="Qu√≠micos">Alumbre</option>slot
<option value="1.30" data-category="Esencias">JUNIOR</option>slot
<option value="5.60" data-category="Esencias">SABRIMAX, PRODISABOR</option>slot
<option value="3.93" data-category="Esencias">AREQUIPE, LECHE C</option>slot
<option value="3.51" data-category="Esencias">PI√ëA</option>slot
<option value="4.80" data-category="Esencias">NATA</option>slot
<option value="3.40" data-category="Esencias">BANANA</option>slot
<option value="3.60" data-category="Esencias">COCO</option>slot
<option value="3.40" data-category="Esencias">NARANJA</option>slot
<option value="1.20" data-category="Bolsas">5X9</option>slot
<option value="1.30" data-category="Bolsas">6X11</option>slot
<option value="1.30" data-category="Bolsas">7X11</option>slot
<option value="1.70" data-category="Bolsas">8X13</option>slot
<option value="1.80" data-category="Bolsas">9X15</option>slot
<option value="1.78" data-category="Bolsas">CARTON</option>slot
<option value="4.00" data-category="Animales">GATARINA</option>slot
<option value="2.50" data-category="Animales">PERRARINA CACHORRO</option>slot
<option value="2.00" data-category="Animales">PERRARINA ADULTO</option>slot
<option value="4.56" data-category="Animales">ALPISTE</option>slot
<option value="6.00" data-category="Animales">ARENA</option>slot
<option value="4.92" data-category="Animales">GATARINA EMPACADA</option>slot
<option value="8.00" data-category="Colores">AMARILLO</option>slot
<option value="8.66" data-category="Colores">AMARILLO LIMA</option>slot
<option value="6.00" data-category="Colores">AMARILLO PAELLERO</option>slot
<option value="15.22" data-category="Colores">AZUL</option>slot
<option value="14.32" data-category="Colores">CHOCOLATE</option>slot
<option value="17.66" data-category="Colores">ROJO</option>slot
<option value="13.00" data-category="Colores">ROJO BRILLANTE</option>slot
<option value="17.66" data-category="Colores">ROJO FRAMBUESA</option>slot
<option value="14.66" data-category="Colores">UVA</option>slot
<option value="9.33" data-category="Colores">VERDE</option>slot
<option value="11.00" data-category="Colores">VERDE MANZANA</option>slot
<option value="4.10" data-category="Reposter√≠a">Nevaz√∫car</option>slot
<option value="8.44" data-category="Reposter√≠a">Arequipe</option>slot
<option value="10.08" data-category="Reposter√≠a">Chocomalti</option>slot
<option value="6.48" data-category="Reposter√≠a">Lluvia de Chocolate</option>slot
<option value="10.00" data-category="Reposter√≠a">Gotas de chocolate</option>slot
<option value="14.40" data-category="Reposter√≠a">Man√≠ Cubierto de Chocolate</option>slot
<option value="6.24" data-category="Reposter√≠a">Lluvia de Colores</option>slot
<option value="8.86" data-category="Reposter√≠a">Grageas</option>slot
<option value="11.76" data-category="Reposter√≠a">Cerezas</option>slot
<option value="8.42" data-category="Reposter√≠a">Chantilly L√≠quido</option>slot
<option value="25.02" data-category="Reposter√≠a">Chantilly en Polvo</option>slot
<option value="5.46" data-category="Reposter√≠a">Maizena</option>slot
<option value="4.10" data-category="Reposter√≠a">Polvo de Hornear</option>slot
<option value="20.04" data-category="Reposter√≠a">Cacao</option>slot
<option value="6.36" data-category="Reposter√≠a">Levadura</option>slot
<option value="12.96" data-category="Reposter√≠a">Pudin y Flan</option>slot
<option value="23.84" data-category="Reposter√≠a">Gelatina sin Sabor</option>slot
<option value="18.00" data-category="Reposter√≠a">Esencia de Vainilla</option>slot
<option value="12.78" data-category="Reposter√≠a">Mini dandy</option>slot
<option value="11.40" data-category="Reposter√≠a">Fruta Confitada</option>slot
<option value="4.56" data-category="Reposter√≠a">Caramelina</option>slot
<option value="3.75" data-category="Reposter√≠a">Leche evaporada</option>slot
<option value="12.04" data-category="Reposter√≠a">Coco Rallado</option>slot
<option value="14.28" data-category="Reposter√≠a">Perlas</option>slot
<option value="19.68" data-category="Reposter√≠a">Gramilla</option>slot
<option value="13.04" data-category="Reposter√≠a">CMC</option>slot
<option value="3.24" data-category="Reposter√≠a">Az√∫car Morena</option>slot
</select>
<!-- Mostrar precio unitario actual -->
 <p>Precio unitario por Kilo</p>
 <p>
    $
<span id="priceUSD">0.00</span>
 / Bs 
<span id="priceBS">0.00</span>
 </p>
 <label for="quantity">Cantidad en gramos</label>
 <input type="number" id="quantity" placeholder="Ingrese la cantidad en gramos" min="1">
 <button onclick="addToCart()">Agregar al carrito</button>
 <h3>Carrito de compras</h3>
 <div id="cart"></div>
 <p>
    <strong>
        Total: $
        <span id="totalUSD">0.00</span>
        / Bs 
        <span id="totalBs">0.00</span>
    </strong>
 </p>
 <button onclick="confirmPurchase()" id="confirmBtn">Confirmar Compra</button>
 <button onclick="window.open('history.html', '_blank')" class="no-print">Ver Historial de Compras</button>
</div>
<div id="invoice" class="container" style="display: none;">
<h2 style="text-align: center;">Nombre del negocio</h2>
<p style="text-align: center;">RIF - Rif del negocio</p>
<p style="text-align: center;">Calle: </p>
<p style="text-align: center;">Ciudad Ojeda, Edo. Zulia</p>
<p>
    <strong>Fecha y Hora</strong>
    <span id="invoice-date"></span>
</p>
<p>
    <strong>Factura N¬∞:</strong>
    <span id="invoice-number"></span>
</p>
<p>
    <strong>Cliente:</strong>
    Consumidor Final
</p>
<table>
    <thead>
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>$/kg</th>
            <th>Subtotal</th>           
        </tr>
    </thead>
    <tbody id="invoice-items">
       <!-- Se llena con JS -->
    </tbody>
</table>
<div class="invoice.total">
    " Total a Pagar: $ "
   <span id="invoice-total-usd">0.00</span>
         " / Bs " 
         <span id="invoice-total-bs">0.00</span>
</div>
<button onclick="printInvoice()" class="no-print">üñ®Ô∏è Imprimir Factura</button>
<button onclick="goBack()" class="no-print">Volver a la Calculadora</button>
</div>
</div>

<script>


        
function obtenerNumeroFacturaFormateado() {
    // Obtenemos el √∫ltimo n√∫mero de factura del localStorage
    let ultimoNumero = localStorage.getItem("ultimoNumeroFactura") || "0";
    let nuevoNumero = parseInt(ultimoNumero) + 1;

    // Guardamos el nuevo n√∫mero
    localStorage.setItem("ultimoNumeroFactura", nuevoNumero);

    // Formateamos como FACT-00001, FACT-00002, etc.
    return "FACT-" + nuevoNumero.toString().padStart(5, "0");
}

        document.addEventListener("DOMContentLoaded", function() {
            // Verificar si el localStorage est√° disponible
            if (typeof(Storage) !== "undefined") {
                console.log("localStorage est√° disponible");
            } else {
                console.log("localStorage NO est√° disponible");
            }

            // Funci√≥n para obtener el n√∫mero de factura formateado
            function obtenerNumeroFacturaFormateado() {
                const a√±oActual = new Date().getFullYear();
                let a√±oGuardado = localStorage.getItem("a√±oFactura");
                let numero = localStorage.getItem("numeroFactura");

                // Verificaci√≥n adicional en consola
                console.log("N√∫mero de factura en localStorage:", numero);
                console.log("A√±o guardado en localStorage:", a√±oGuardado);

                if (!a√±oGuardado || parseInt(a√±oGuardado) !== a√±oActual) {
                    // Nuevo a√±o: reiniciar contador
                    numero = 1;
                    localStorage.setItem("a√±oFactura", a√±oActual);
                } else {
                    // Mismo a√±o: incrementar n√∫mero
                    numero = parseInt(numero) + 1;
                }

                localStorage.setItem("numeroFactura", numero);

                const numeroFormateado = String(numero).padStart(4, '0');
                console.log("N√∫mero de factura formateado:", numeroFormateado); // Verificar en consola
                return `FAC-${a√±oActual}-${numeroFormateado}`;
            }

            // Funci√≥n para llenar los datos y mostrar la factura antes de imprimir
            function prepararFacturaParaImprimir() {
                const numeroFactura = obtenerNumeroFacturaFormateado();
                console.log("N√∫mero de factura generado:", numeroFactura);  // Verificar en consola

                // Asegurarse de que el n√∫mero de factura se agregue a la factura
                document.getElementById("invoice-number").textContent = numeroFactura;

                // Asignar la fecha actual
                const fecha = new Date().toLocaleString();
                document.getElementById("invoice-date").textContent = fecha;

                // Mostrar el contenedor de la factura
                document.getElementById("invoice").style.display = 'block';
            }

            // Funci√≥n para imprimir la factura
            window.imprimirFactura = function() {
                console.log("Bot√≥n de imprimir presionado");  // Verificaci√≥n
                prepararFacturaParaImprimir();
                window.print(); // Imprimir
            }
        });


        let dollarRate = 0;
        let cart = [];
    
        const products = {
                "Condimentos semi": [
                    { name: "Ali√±o semi", price_usd_kg: 4.20 },
                    { name: "Adobo semi", price_usd_kg: 2.88 },
                    { name: "Carmencita", price_usd_kg: 4.12 },
                    { name: "Cubito semi", price_usd_kg: 2.58 },
                    { name: "Pimienta semi", price_usd_kg: 6.04 },
                    { name: "Curry semi", price_usd_kg: 3.60 },
                    { name: "Ajo semi", price_usd_kg: 4.60 },
                    { name: "Comino semi", price_usd_kg: 8.64 },
                    { name: "Sabroceador semi", price_usd_kg: 4.32 },
                    { name: "Or√©gano Molido", price_usd_kg: 8.80 },
                    { name: "Or√©gano Entero", price_usd_kg: 7.00 },
                    { name: "Combinaditos", price_usd_kg: 4.60 }
                ],
                "Condimentos Puros": [
                    { name: "Ali√±o puro", price_usd_kg: 7.30 },
                    { name: "Cubito puro", price_usd_kg: 7.00 },
                    { name: "Adobo puro", price_usd_kg: 6.48 },
                    { name: "Ajo Mix", price_usd_kg: 5.30 },
                    { name: "Ajo Granulado", price_usd_kg: 18.00 },
                    { name: "Cebolla", price_usd_kg: 17.04 },
                    { name: "C√∫rcuma", price_usd_kg: 12.00 },
                    { name: "Jengibre", price_usd_kg: 7.56 },
                    { name: "Paprika Dulce", price_usd_kg: 15.04 },
                    { name: "Paprika Picante", price_usd_kg: 13.04 },
                    { name: "Comino puro", price_usd_kg: 20.00 },
                    { name: "Curry puro", price_usd_kg: 11.04 },
                    { name: "Pimienta pura", price_usd_kg: 26.00 },
                    { name: "Trifog√≥n", price_usd_kg: 5.94 },
                    { name: "7 Especies", price_usd_kg: 40.00 },
                    { name: "Salchina", price_usd_kg: 5.94 },
                    { name: "Ajo Entero", price_usd_kg: 6.50 }
                ],
                "Hierbas e Infusiones": [
                    { name: "Flor de Jamaica", price_usd_kg: 18.00 },
                    { name: "Manzanilla", price_usd_kg: 21.67 },
                    { name: "T√© Verde", price_usd_kg: 22.00 },
                    { name: "Hierbabuena", price_usd_kg: 15.04 },
                    { name: "T√© Negro", price_usd_kg: 22.00 },
                    { name: "Sen", price_usd_kg: 14.00 },
                    { name: "Tomillo", price_usd_kg: 13.60 },
                    { name: "Menta", price_usd_kg: 11.04 },
                    { name: "Laurel", price_usd_kg: 15.00 },
                    { name: "Romero", price_usd_kg: 13.60 },
                    { name: "Albahaca", price_usd_kg: 14.00 },
                    { name: "Stevia", price_usd_kg: 19.44 },
                    { name: "Clavitos", price_usd_kg: 39.00 },
                    { name: "Canela Entera", price_usd_kg: 25.00 },
                    { name: "Canela Molida", price_usd_kg: 27.00 },
                    { name: "An√≠s Estrellado", price_usd_kg: 28.00 },
                    { name: "Malagueta", price_usd_kg: 19.66 },
                    { name: "Perejil", price_usd_kg: 9.28 },
                    { name: "Tilo", price_usd_kg: 55.00 },
                    { name: "Vinagre de manzana", price_usd_kg: 7.2 },
                    { name: "Aceite de coco", price_usd_kg: 28.08 },
                    { name: "Aceite de oliva", price_usd_kg: 7.13 },
                    { name: "Nuez moscada", price_usd_kg: 36.00 },
                    { name: "Panela", price_usd_kg: 0.75 }
                ],
                "Semillas": [
                    { name: "Ch√≠a", price_usd_kg: 18.40 },
                    { name: "An√≠s Dulce", price_usd_kg: 14.20 },
                    { name: "Linaza", price_usd_kg: 4.24 },
                    { name: "Girasol", price_usd_kg: 5.60 },
                    { name: "Auyama", price_usd_kg: 5.40 },
                    { name: "Patilla", price_usd_kg: 4.32 },
                    { name: "Fenogreco", price_usd_kg: 7.23 },
                    { name: "Ajonjol√≠ Natural", price_usd_kg: 4.86 },
                    { name: "Ajonjol√≠ Blanco", price_usd_kg: 12.00 },
                    { name: "Ajonjol√≠ Negro", price_usd_kg: 16.00 },
                    { name: "Comino Entero", price_usd_kg: 18.00 },
                    { name: "Pimienta Negra Entera", price_usd_kg: 24.00 },
                    { name: "Pimienta Blanca Entera", price_usd_kg: 40.00 },
                    { name: "Pimienta Roja Entera", price_usd_kg: 50.00 },
                    { name: "Hinojo", price_usd_kg: 14.00 },
                    { name: "Quinoa", price_usd_kg: 13.04 },
                    { name: "Mostaza", price_usd_kg: 7.04 },
                    { name: "Cilantro Semilla", price_usd_kg: 14.00 },
                    { name: "Cebada", price_usd_kg: 5.55 },
                    { name: "Aceitunas", price_usd_kg: 10.74 },
                    { name: "Alcaparras", price_usd_kg: 7.50 },
                    { name: "Trigo Fino", price_usd_kg: 5.18 },
                    { name: "Avena", price_usd_kg: 2.70 },
                    { name: "Afrecho", price_usd_kg: 2.70 },
                    { name: "Achote", price_usd_kg: 17.50 },
                    { name: "Sal de Mesa", price_usd_kg: 0.50 },
                    { name: "Pasas", price_usd_kg: 8.60 },
                    { name: "Ciruela Pasas", price_usd_kg: 13.80 },
                    { name: "Sal Rosada", price_usd_kg: 10.00 },
                    { name: "Sal Marina", price_usd_kg: 2.35 }
                ],
                "Maniseria": [
                    { name: "Frutos secos", price_usd_kg: 7.20 },
                    { name: "Frutos secos +1kg", price_usd_kg: 6.20 },
                    { name: "Frutos secos +5kg", price_usd_kg: 6.00 },
                    { name: "Ma√≠z Tostado", price_usd_kg: 18.00 },
                    { name: "Man√≠ Triturado", price_usd_kg: 7.10 },
                    { name: "Cocomani", price_usd_kg: 8.00 },
                    { name: "Man√≠ Salado Jumbo", price_usd_kg: 12.60 },
                    { name: "Man√≠ con Ajonjol√≠", price_usd_kg: 6.40 },
                    { name: "Man√≠ Pimienta Lim√≥n", price_usd_kg: 8.00 },
                    { name: "Man√≠ con Concha", price_usd_kg: 8.40 },
                    { name: "Man√≠ Garrapi√±ado", price_usd_kg: 6.40 },
                    { name: "Man√≠ con Sal", price_usd_kg: 8.60 },
                    { name: "Man√≠ sin Sal", price_usd_kg: 7.23 },
                    { name: "Man√≠ Japon√©s y Variantes", price_usd_kg: 12.80 },
                    { name: "Almendras", price_usd_kg: 18.13 },
                    { name: "Almendras Fileteadas", price_usd_kg: 37.56 },
                    { name: "Almendras con Ajonjol√≠", price_usd_kg: 24.00 },
                    { name: "Almendras con Coco", price_usd_kg: 20.16 },
                    { name: "Almendras Garrapi√±adas", price_usd_kg: 27.60 },
                    { name: "Almendras Saladas", price_usd_kg: 30.08 },
                    { name: "Avellanas", price_usd_kg: 24.69 },
                    { name: "Merey", price_usd_kg: 33.15 },
                    { name: "Pistacho", price_usd_kg: 33.58 },
                    { name: "Nueces", price_usd_kg: 27.60 }
                ],
                "Turrones": [
                    { name: "Blanco con Man√≠ (unidad)", price_usd_kg: 0.40 },
                    { name: "Acaramelado con Ajonjol√≠ (unidad)", price_usd_kg: 0.40 },
                    { name: "Acaramelado con Man√≠ (unidad)", price_usd_kg: 0.40 },
                    { name: "Mixto (unidad)", price_usd_kg: 0.40 },
                    { name: "Turr√≥n de Almendras", price_usd_kg: 2.16 },
                    { name: "Turr√≥n de Avellanas", price_usd_kg: 2.50 },
                    { name: "Turr√≥n de Merey", price_usd_kg: 2.16 },
                    { name: "Turr√≥n de Pistacho", price_usd_kg: 3.83 },
                    { name: "Turr√≥n Gourmet", price_usd_kg: 2.16 }
                ],
                "Granos": [
                    { name: "Caraota Negra", price_usd_kg: 5.20 },
                    { name: "Caraota Roja", price_usd_kg: 3.02 },
                    { name: "Caraota Blanca", price_usd_kg: 3.24 },
                    { name: "Arvejas", price_usd_kg: 4.75 },
                    { name: "Lentejas", price_usd_kg: 5.50 },
                    { name: "Cotufas", price_usd_kg: 2.32 },
                    { name: "Garbanzos", price_usd_kg: 4.80 },
                    { name: "Pico Negro", price_usd_kg: 1.62 }
                ],
                "Qu√≠micos": [
                    { name: "Benzoato de Sodio", price_usd_kg: 9.04 },
                    { name: "Sal de Epson", price_usd_kg: 6.78 },
                    { name: "√Åcido C√≠trico", price_usd_kg: 5.20 },
                    { name: "Azufre", price_usd_kg: 3.87 },
                    { name: "√Åcido B√≥rico", price_usd_kg: 12.56 },
                    { name: "Alumbre", price_usd_kg: 7.70 }
                ],
                "Esencias": [
                    { name: "Esencia JUNIOR", price_usd_kg: 1.30 },
                    { name: "Esencia SABRIMAX", price_usd_kg: 5.60 },
                    { name: "Esencia PRODISABOR", price_usd_kg: 5.60 },
                    { name: "Esencia Arequipe", price_usd_kg: 3.93 },
                    { name: "Esencia Leche Condensada", price_usd_kg: 3.93 },
                    { name: "Esencia Pi√±a", price_usd_kg: 3.51 },
                    { name: "Esencia Nata", price_usd_kg: 4.80 },
                    { name: "Esencia Banana", price_usd_kg: 3.40 },
                    { name: "Esencia Coco", price_usd_kg: 3.60 },
                    { name: "Esencia Naranja", price_usd_kg: 3.40 }
                ],
                "Bolsas": [
                    { name: "Bolsa 5x9", price_usd_kg: 1.20 },
                    { name: "Bolsa 6x11", price_usd_kg: 1.30 },
                    { name: "Bolsa 7x11", price_usd_kg: 1.30 },
                    { name: "Bolsa 8x13", price_usd_kg: 1.70 },
                    { name: "Bolsa 9x15", price_usd_kg: 1.80 },
                    { name: "Cart√≥n", price_usd_kg: 1.78 }
                ],
                "Animales": [
                    { name: "Gatarina", price_usd_kg: 4.00 },
                    { name: "Perrarina Cachorro", price_usd_kg: 2.50 },
                    { name: "Perrarina Adulto", price_usd_kg: 2.00 },
                    { name: "Alpiste", price_usd_kg: 4.56 },
                    { name: "Arena para Gatos", price_usd_kg: 6.00 },
                    { name: "Gatarina Empacada", price_usd_kg: 4.92 }
                ],
                "Colores": [
                    { name: "Color Amarillo", price_usd_kg: 8.00 },
                    { name: "Color Amarillo Lima", price_usd_kg: 8.66 },
                    { name: "Color Amarillo Paellero", price_usd_kg: 6.00 },
                    { name: "Color Azul", price_usd_kg: 15.22 },
                    { name: "Color Chocolate", price_usd_kg: 14.32 },
                    {name: "Color Rojo", price_usd_kg: 17.66 },
                    {name: "Color Rojo Brillante", price_usd_kg: 13.00 },
                    {name: "Color Rojo Frambuesa", price_usd_kg: 17.66 },
                    {name: "Color Rosado", price_usd_kg: 19.66 },
                    {name: "Color Uva", price_usd_kg: 14.66 },
                    {name: "Color Verde", price_usd_kg: 9.33 },
                    {name: "Color Verde Manzana", price_usd_kg: 11.00 },
                    ],
                    "Reposter√≠a": [
                    { name: "Nevaz√∫car", price_usd_kg: 4.10 },
                        { name: "Arequipe", price_usd_kg: 8.44 },
                        { name: "Chocomalti", price_usd_kg: 10.08 },
                        { name: "Lluvia de Chocolate", price_usd_kg: 6.48 },
                        { name: "Gotas de Chocolate", price_usd_kg: 10.00 },
                        { name: "Man√≠ Cubierto de Chocolate", price_usd_kg: 14.40 },
                        { name: "Lluvia de Colores", price_usd_kg: 6.24 },
                        { name: "Grageas", price_usd_kg: 8.86 },
                        { name: "Cerezas", price_usd_kg: 11.76 },
                        { name: "Chantilly L√≠quido", price_usd_kg: 8.42 },
                        { name: "Chantilly en Polvo", price_usd_kg: 25.02 },
                        { name: "Maizena", price_usd_kg: 5.46 },
                        { name: "Polvo de Hornear", price_usd_kg: 4.10 },
                        { name: "Cacao", price_usd_kg: 20.04 },
                        { name: "Levadura", price_usd_kg: 6.36 },
                        { name: "Pudin y Flan", price_usd_kg: 12.96 },
                        { name: "Gelatina sin Sabor", price_usd_kg: 23.84 },
                        { name: "Gelatina de Sabor", price_usd_kg: 10.00 },
                        { name: "Esencia de Vainilla", price_usd_kg: 18.00 },
                        { name: "Mini dandy", price_usd_kg: 12.78 },
                        { name: "Fruta Confitada", price_usd_kg: 11.40 },
                        { name: "Caramelina", price_usd_kg: 4.56 },
                        { name: "Leche evaporada", price_usd_kg: 3.75 },
                        { name: "Coco Rallado", price_usd_kg: 12.04 },
                        { name: "Perlas", price_usd_kg: 14.28 },
                        { name: "Gramilla", price_usd_kg: 19.68 },
                        { name: "CMC", price_usd_kg: 13.04 },
                        { name: "Az√∫car Morena", price_usd_kg: 3.24 },
                        ],

                 "Agropecuaria": [
                        { name: "Cerdo C casera 20kg", price_usd_kg: 12.80 },
                        { name: "Cerdo C casera Detal", price_usd_kg: 0.94 },
                        { name: "Cerdo C casera 20kg +10 sacos", price_usd_kg: 12.30 },
                        { name: "pollo C casera 20kg", price_usd_kg: 13.20 },
                        { name: "pollo C casera 20kg +10 sacos", price_usd_kg: 12.30 },
                        { name: "pollo C casera Detal", price_usd_kg: 0.94 },
                        { name: "Pollo engorde 40kg", price_usd_kg: 36.80 },
                        { name: "Pollo engorde Detal", price_usd_kg: 1.32 },
                        { name: "Pollo iniciador 40kg", price_usd_kg: 36.80 },
                        { name: "Pollo iniciador Detal", price_usd_kg: 1.32 },
                        { name: "Vaca lechera 35kg", price_usd_kg: 18.90 },
                        { name: "Vaca lechera 35kg +10sacos", price_usd_kg: 16.50 },
                        { name: "Ponedora M y E 40kg", price_usd_kg: 35.20 },
                        { name: "Ponedora M y E Detal", price_usd_kg: 1.15 },
                        { name: "Usos multiples 35kg", price_usd_kg: 16.45 },
                        { name: "Usos multiples 35kg +10 sacos", price_usd_kg: 15.00 },
                        { name: "Usos multiples Detal", price_usd_kg: 0.70 },
                        { name: "usos multiples 20kg", price_usd_kg: 13.20 },
                        { name: "Mi ringo 8kg", price_usd_kg: 27.00 },
                        { name: "Mi ringo Detal", price_usd_kg: 4.00 },
                        { name: "Mi ringo 15kg", price_usd_kg: 48.00 },
                        { name: "Ringo adulto 30kg", price_usd_kg: 48.00 },
                        { name: "Ringo adulto Detal", price_usd_kg: 2.00 },
                        { name: "Ringo cachorro 30kg", price_usd_kg: 58.00 },
                        { name: "Ringo cachorro Detal", price_usd_kg: 2.50 },
                        { name: "filpo perro 30kg", price_usd_kg: 56.40 },
                        { name: "filpo perro Detal", price_usd_kg: 2.28 },
                        { name: "filpo Gato 8kg", price_usd_kg: 30.00 },
                        { name: "filpo Gato Detal", price_usd_kg: 4.68 },
                        { name: "Gatsy 16kg", price_usd_kg: 60.00 },
                        { name: "Gatsy Detal", price_usd_kg: 4.68 },
                        { name: "Dog chow 20kg", price_usd_kg: 84.00 },
                        { name: "Dog chow Detal", price_usd_kg: 5.40 },
                        { name: "Super can 30kg", price_usd_kg: 56.40 },
                        { name: "Super can Detal", price_usd_kg: 2.28 },
                        { name: "Cipacat 30kg", price_usd_kg: 73.00 },
                        { name: "Cipacat Detal", price_usd_kg: 3.30 },
                        { name: "Mi ringo paq", price_usd_kg: 4.92 }
                    ],
            };
    
        async function fetchDollarRate() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                if (data && data.rates && data.rates.VES) {
                    dollarRate = data.rates.VES;
                    document.getElementById('dollarRate').innerText = `Tasa del d√≥lar BCV: ${dollarRate.toFixed(2)} Bs.`;
                } else {
                    document.getElementById('dollarRate').innerText = "Error al obtener la tasa del d√≥lar.";
                }
            } catch (error) {
                document.getElementById('dollarRate').innerText = "Error al cargar la tasa del d√≥lar.";
            }
        }
    
        function filterProducts() {
            const categorySelect = document.getElementById('category');
            const productSelect = document.getElementById('product');
            const selectedCategory = categorySelect.value;
    
            productSelect.innerHTML = '<option value="">Seleccionar Producto</option>';
            productSelect.disabled = true;
    
            if (selectedCategory && products[selectedCategory]) {
                products[selectedCategory].forEach(product => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(product);
                    option.textContent = product.name;
                    productSelect.appendChild(option);
                });
                productSelect.disabled = false;
            }
        }
    
        function calculatePrice(product, quantity) {
            let pricePerKg = product.price_usd_kg;
            let gramsNumber = parseFloat(quantity);
    
            if (gramsNumber < 250) {
                pricePerKg *= 1.6; // Aumenta un 60%
            }
    
            const priceInUSD = (pricePerKg * gramsNumber) / 1000;
            const priceInBs = priceInUSD * dollarRate;
    
            return {
                usd: priceInUSD.toFixed(2),
                bs: priceInBs.toFixed(2)
            };
        }
    
        document.addEventListener('DOMContentLoaded', function () {
            const quantityInput = document.getElementById('quantity');
            const productSelect = document.getElementById('product');
    
            function updateDisplayedPrice() {
                const selectedProductStr = productSelect.value;
                const grams = quantityInput.value;
    
                if (!selectedProductStr || !grams) return;
    
                const selectedProduct = JSON.parse(selectedProductStr);
                const finalPrice = calculatePrice(selectedProduct, grams);
    
                document.getElementById('priceUSD').innerText = `USD: ${finalPrice.usd}`;
                document.getElementById('priceBS').innerText = `Bs: ${finalPrice.bs}`;
            }
    
            quantityInput.addEventListener('input', updateDisplayedPrice);
            productSelect.addEventListener('change', updateDisplayedPrice);
        });
    
        function addToCart() {
            const productSelect = document.getElementById('product');
            const quantityInput = document.getElementById('quantity');
            const selectedProductJson = productSelect.value;
            const quantity = parseFloat(quantityInput.value);
    
            if (selectedProductJson && quantity > 0) {
                const selectedProduct = JSON.parse(selectedProductJson);
                let pricePerKg = selectedProduct.price_usd_kg;
    
                if (quantity < 250) {
                    pricePerKg *= 1.6;
                }
    
                const totalPriceUSD = (pricePerKg * quantity) / 1000;
                const totalPriceBs = totalPriceUSD * dollarRate;
    
                cart.push({
                    name: selectedProduct.name,
                    quantity: quantity,
                    price_usd_kg: selectedProduct.price_usd_kg,
                    totalPriceUSD: totalPriceUSD,
                    totalPriceBs: totalPriceBs
                });
    
                updateCartDisplay();
                quantityInput.value = '';
                document.getElementById('priceUSD').innerText = 'USD: 0';
                document.getElementById('priceBS').innerText = 'Bs: 0';
                document.getElementById('confirmBtn').disabled = false;
            } else {
                alert("Por favor, seleccione un producto e ingrese una cantidad v√°lida.");
            }
        }
    
        function updateCartDisplay() {
            const cartDiv = document.getElementById('cart');
            const totalUSDElement = document.getElementById('totalUSD');
            const totalBsElement = document.getElementById('totalBs');
            let cartHTML = '';
            let totalUSD = 0;
            let totalBs = 0;
    
            cart.forEach((item, index) => {
                cartHTML += `
                    <div class="cart-item">
                        <span>${item.name} (${item.quantity}g)</span>
                        <span>$${item.totalPriceUSD.toFixed(2)} / Bs ${item.totalPriceBs.toFixed(2)}</span>
                        <button onclick="removeFromCart(${index})">Eliminar</button>
                    </div>
                `;
                totalUSD += item.totalPriceUSD;
                totalBs += item.totalPriceBs;
            });
    
            cartDiv.innerHTML = cartHTML;
            totalUSDElement.textContent = totalUSD.toFixed(2);
            totalBsElement.textContent = totalBs.toFixed(2);
        }
    
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            if (cart.length === 0) {
                document.getElementById('confirmBtn').disabled = true;
            }
        }

        function actualizarVistaCarrito() {
    const cartContainer = document.getElementById("cart");
    cartContainer.innerHTML = "";

    if (cart.length === 0) {
        cartContainer.innerHTML = "<tr><td colspan='5'>El carrito est√° vac√≠o.</td></tr>";
    } else {
        cart.forEach((item, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${item.nombre}</td>
                <td>${item.precioUSD.toFixed(2)}</td>
                <td>${item.cantidad}</td>
                <td>${item.totalPriceUSD.toFixed(2)}</td>
                <td><button onclick="eliminarItemCarrito(${index})">Eliminar</button></td>
            `;
            cartContainer.appendChild(row);
        });
    }

    const totalUSD = cart.reduce((sum, item) => sum + item.totalPriceUSD, 0);
    const totalBs = cart.reduce((sum, item) => sum + item.totalPriceBs, 0);
    document.getElementById("totalUSD").textContent = totalUSD.toFixed(2);
    document.getElementById("totalBs").textContent = totalBs.toFixed(2);
}

    
        function confirmPurchase() {
    if (cart.length === 0) {
        alert("El carrito est√° vac√≠o. Agrega productos antes de confirmar la compra.");
        return;
    }

    const now = new Date();
    const fechaHora = now.toLocaleDateString() + " " + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Mostrar la fecha en la factura
    document.getElementById("invoice-date").innerText = fechaHora;

        // Obtener y mostrar el n√∫mero de factura
    const numeroFactura = obtenerNumeroFacturaFormateado();
    document.getElementById("invoice-number").textContent = numeroFactura;


    // Guardar compra en historial
    const compra = {
        fecha: fechaHora,
        items: [...cart], // Copiamos el contenido del carrito
        totalUSD: cart.reduce((sum, item) => sum + item.totalPriceUSD, 0),
        totalBs: cart.reduce((sum, item) => sum + item.totalPriceBs, 0)
    };

    let historial = JSON.parse(localStorage.getItem("historialCompras")) || [];

    // Limpiar entradas de d√≠as anteriores
    const hoy = new Date().toLocaleDateString();
    historial = historial.filter(c => c.fecha.startsWith(hoy));

    historial.push(compra);
    localStorage.setItem("historialCompras", JSON.stringify(historial));

    // Mostrar factura
    renderInvoice();
    document.getElementById('calculator').style.display = 'none';
    document.getElementById('invoice').style.display = 'block';
        
    // Limpiar carrito
        cart = [];
    actualizarVistaCarrito(); // Esta funci√≥n deber√≠a redibujar el carrito vac√≠o

}

    
        function renderInvoice() {
    const now = new Date();
    const fechaHora = now.toLocaleDateString() + " " + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    document.getElementById("invoice-date").innerText = fechaHora;

    const invoiceItemsBody = document.getElementById('invoice-items'); 
    const invoiceTotalUSD = document.getElementById('invoice-total-usd');
    const invoiceTotalBs = document.getElementById('invoice-total-bs');

    let invoiceHTML = '';
    let totalUSD = 0;
    let totalBs = 0;

    cart.forEach(item => {
        invoiceHTML += `
            <tr>
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>${item.price_usd_kg.toFixed(2)}</td>
                <td>${item.totalPriceUSD.toFixed(2)}</td>
            </tr>
        `;
        totalUSD += item.totalPriceUSD;
        totalBs += item.totalPriceBs;
    });

    invoiceItemsBody.innerHTML = invoiceHTML;
    invoiceTotalUSD.textContent = totalUSD.toFixed(2);
    invoiceTotalBs.textContent = totalBs.toFixed(2);
}

    
        function printInvoice() {
            window.print();
        }
    
        function goBack() {
            document.getElementById('invoice').style.display = 'none';
            document.getElementById('calculator').style.display = 'block';
        }
    
        fetchDollarRate();
    
    </script>
</body>
</html>